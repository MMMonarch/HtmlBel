<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>HRMS Belarus – Комплаенс и архитектура (.NET MAUI Blazor Hybrid + PostgreSQL + n8n)</title>
  <style>
    body { font-family: "Segoe UI", Arial, sans-serif; margin: 24px; line-height: 1.5; color: #1a1a1a; }
    h1, h2, h3, h4 { color: #0f3d61; margin-top: 28px; }
    table { border-collapse: collapse; width: 100%; margin: 12px 0; }
    table th, table td { border: 1px solid #c0c6d0; padding: 8px 10px; vertical-align: top; }
    table th { background: #eef3f9; }
    .tag { display: inline-block; padding: 2px 8px; margin-right: 6px; border-radius: 4px; background: #e8f1ff; color: #0f3d61; font-size: 12px; }
    .risk-high { color: #a40000; font-weight: 600; }
    .risk-medium { color: #9a6700; font-weight: 600; }
    .risk-low { color: #1b7c3a; font-weight: 600; }
    ul { margin: 6px 0 6px 20px; }
    .section-summary { background: #f7f9fb; padding: 12px 14px; border-left: 4px solid #0f3d61; margin: 12px 0; }
  </style>
</head>
<body>
  <h1>HRMS (автоматизированный юридический контролер) для коммерческой организации в Республике Беларусь</h1>

  <div class="section-summary">
    <strong>Цель документа:</strong> сформировать комплаенс-ориентированную архитектуру и интерфейсные требования для HRMS на стеке <strong>C# .NET MAUI Blazor Hybrid + PostgreSQL + n8n</strong> с фокусом на превенцию нарушений трудового законодательства РБ «на уровне кода и данных».
  </div>

  <h2>ЭТАП 0. Контекст и допущения</h2>
  <p>Организация: коммерческая компания в РБ, 200–1000 сотрудников, 2–10 филиалов; кадровый отдел 3–15 человек; часть работников в сменном и суммированном учете. Инфраструктура и данные размещаются в РБ.</p>
  <ul>
    <li><strong>В объеме:</strong> кадровое делопроизводство (прием/перевод/увольнение/отпуска/командировки/больничные), штатное расписание, табель/суммированный учет, ПУ-1/2/3, воинский учет, КЭДО/ЭЦП (Avest, ГосСУОК), интеграции со СКУД и бухгалтерией.</li>
    <li><strong>Не в объеме:</strong> расчет зарплаты (отдельная система), но экспорт/интеграционный интерфейс предусмотрен; рекрутинг и ATS — опционально.</li>
    <li><strong>Принципы обработки ПДн:</strong> минимизация, целевое назначение, локализация в РБ, ролевая модель, журналирование доступа, управление согласием и отзывом, защита каналов и хранилищ.</li>
  </ul>

  <h2>ЭТАП 1. Нормативная матрица соответствия</h2>
  <p>Ключевые требования с контролями и артефактами:</p>
  <table>
    <thead>
      <tr><th>Требование</th><th>Риск нарушения</th><th>Техконтроль в системе</th><th>Артефакт (лог/отчет)</th></tr>
    </thead>
    <tbody>
      <tr>
        <td>Локализация данных в РБ (Указ №60)</td>
        <td class="risk-high">Штрафы, блокировка ресурса, предписание</td>
        <td>Деплой только в DC/облаках РБ; запрещены внешние облака; проверки DNS/IP; контроль местоположения бэкапов</td>
        <td>Отчет о размещении ресурсов; журнал копий с указанием локации</td>
      </tr>
      <tr>
        <td>Согласия и права субъектов (Закон №99-З)</td>
        <td class="risk-high">Незаконная обработка ПДн</td>
        <td>Реестр согласий, срок действия, статус; блокировка операций при отсутствии согласия; API для отзывов</td>
        <td>Логи изменений статусов согласий; отчеты об отзыве и анонимизации</td>
      </tr>
      <tr>
        <td>Контракты, прием/увольнение (ТК РБ; Декрет №29)</td>
        <td class="risk-high">Незаконные условия, скрытый бессрочный договор</td>
        <td>Бизнес-правила: минимум 1 год; предельный суммарный срок; блокировка продления сверх лимита; обязательность приказа</td>
        <td>Протокол валидаций; реестр приказов; PDF с ЭЦП</td>
      </tr>
      <tr>
        <td>ПУ-1/2/3 форматы и сроки (ФСЗН)</td>
        <td class="risk-medium">Штрафы, возврат отчетности</td>
        <td>Справочники кодов; валидация периодов; генерация текстовых файлов; подготовка JSON+подпись для API</td>
        <td>Журнал выгрузок ПУ; контроль дедлайнов; протокол ошибок</td>
      </tr>
      <tr>
        <td>Воинский учет и уведомления</td>
        <td class="risk-medium">Админответственность, штрафы</td>
        <td>Обязательные поля до приказа; SLA уведомлений; задачи и напоминания; контроль сверки</td>
        <td>Логи отправок; отчеты сверки; список просроченных уведомлений</td>
      </tr>
      <tr>
        <td>ИБ/ОАЦ: управление доступом и журналирование</td>
        <td class="risk-high">Утечка ПДн, инциденты</td>
        <td>RLS в БД; RBAC; MFA/ЭЦП; логирование чтения/изменения; SIEM интеграция</td>
        <td>Audit trail; экспорт в syslog/SIEM; отчеты о доступах</td>
      </tr>
    </tbody>
  </table>

  <h2>ЭТАП 2. Архитектурное описание + принципы интеграции</h2>
  <h3>Развертывание и сегментация</h3>
  <ul>
    <li>Инфраструктура: on-premise или облако белорусского провайдера; все данные в РБ.</li>
    <li>Сегменты: рабочие места кадровиков → приложение MAUI Blazor Hybrid (Windows обязателен); сервер приложений/API; PostgreSQL; n8n; хранилище документов; криптопровайдер (Avest/GosСУОК); шлюзы интеграций (СКУД, бухгалтерия, ФСЗН).</li>
    <li>Связь: TLS с внутренним CA; VPN/MTLS между сегментами; терминаторы TLS в DMZ; журналирование трафика.</li>
    <li>Клиентская модель: офлайн-кэш MAUI; синхронизация с очередью изменений и мерджем; защита локального хранилища (DPAPI/OS keystore).</li>
  </ul>

  <h3>Логическая схема компонентов (текст)</h3>
  <p>UI (MAUI Blazor Hybrid) → API Gateway → Сервисы (Кадры, Штатка, Табель, Документооборот, ФСЗН, Воинский учет, Справочники, Безопасность) → Доменный слой (CQRS + валидации) → PostgreSQL (RLS, temporal) → Документохранилище (PDF, подписи) → Интеграции (СКУД, бухгалтерия/1С, ФСЗН, ГосСУОК) → n8n (оркестрация).</p>

  <h3>Bounded Contexts</h3>
  <ul>
    <li><strong>Штатка</strong>: positions, org_units, FTE.</li>
    <li><strong>Кадры</strong>: employees, employments, contracts, orders.</li>
    <li><strong>Документооборот</strong>: employee_documents, подписи.</li>
    <li><strong>Табель</strong>: timesheets, absences, производственный календарь.</li>
    <li><strong>ФСЗН</strong>: fszn_exports, маппинг кодов.</li>
    <li><strong>Воинский учет</strong>: military_records, уведомления.</li>
    <li><strong>Справочники</strong>: классификаторы должностей/видов договоров.</li>
    <li><strong>Безопасность/Аудит</strong>: roles, permissions, audit_trails, consent_records.</li>
  </ul>

  <h3>Интеграции и надежность</h3>
  <ul>
    <li>Событийная модель: outbox pattern (PostgreSQL → брокер/таблица outbox → n8n); идемпотентные consumer’ы.</li>
    <li>Ретраи и дедупликация: ключ идемпотентности = тип события + сущность + версия; хранение статуса доставки.</li>
    <li>СКУД (Perco/Bolid): событие «приказ подписан» → активация/блокировка пропуска.</li>
    <li>Бухгалтерия/1С: обмен табелем и справочниками через файлы или API; журнал трансформаций.</li>
    <li>ФСЗН: экспорт текстовых файлов; подготовка к API (HTTPS + подпись Avest).</li>
  </ul>

  <h2>ЭТАП 3. Модель данных PostgreSQL (legal-by-design)</h2>
  <h3>Ключевые таблицы</h3>
  <ul>
    <li>employees(id, fio, birth_date, id_doc, snils, contact, consent_status,...)</li>
    <li>positions(id, org_unit_id, classifier_code, title, fte, valid_from/to)</li>
    <li>employments(id, employee_id, position_id, contract_id, start_date, end_date, status)</li>
    <li>contracts(id, number, type, start_date, end_date, prolongation_count, terms_jsonb)</li>
    <li>orders(id, type, date, employment_id, files, signature_hash)</li>
    <li>timesheets(id, period, org_unit_id, rows_jsonb)</li>
    <li>absences(id, employee_id, period_from, period_to, type, order_id)</li>
    <li>military_records(id, employee_id, category, commissariat, notified_at)</li>
    <li>fszn_exports(id, type, period, file_path, status, errors_jsonb)</li>
    <li>consent_records(id, employee_id, purpose, status, valid_from/to)</li>
    <li>audit_trails(id, user, action, entity, entity_id, fields, at, reason)</li>
    <li>roles, permissions, role_permissions, user_roles</li>
  </ul>

  <h3>История и временные данные</h3>
  <ul>
    <li>Схема valid_from/valid_to для positions, employments, contracts, org_units.</li>
    <li>История окладов/условий труда в terms_jsonb + версия.</li>
  </ul>

  <h3>RLS и целостность</h3>
  <ul>
    <li>Row-Level Security по org_unit_id и филиалу; контекст текущего пользователя в сессии.</li>
    <li>EXCLUDE constraints: отсутствие пересечений отпусков/больничных/командировок; уникальность табеля на период+подразделение.</li>
    <li>NOT NULL и FK: employment обязателен к position; order привязан к employment/contract.</li>
    <li>Право на забвение: функция анонимизации (обнуление PII, сохранение агрегатов).</li>
    <li>Audit logging через триггеры: фиксация чтения и изменения полей ПДн.</li>
  </ul>

  <h2>ЭТАП 4. Безопасность и криптография (Avest / ГосСУОК, КЭДО)</h2>
  <ul>
    <li>Аутентификация: кадровики — вход по ЭЦП (ID-карта/USB-токен) через Avest CSP; сотрудники — упрощенная схема + усиление для ПДн (OTP/ЭЦП).</li>
    <li>Подписание: договоры, приказы, личные карточки, ПУ выгрузки — подписание ЭЦП; хранение подписи и хэша документа; проверка при каждом открытии.</li>
    <li>Ключи: хранение на токенах/смарт-картах; запрет экспорта; логирование операций подписи/валидации.</li>
    <li>Защита данных: шифрование дисков/бэкапов; секреты в хранилище (Vault); ротация ключей; контроль восстановления.</li>
    <li>Ролевая модель: кадровик, руководитель, ВУР, бухгалтерия (агрегаты), администратор, аудитор.</li>
  </ul>

  <h2>ЭТАП 5. Модульный анализ (функционал + юридические контроли)</h2>
  <h3>5.1 Штатное расписание</h3>
  <ul>
    <li><strong>Назначение:</strong> первичная сущность FTE и связка с приемом.</li>
    <li><strong>Юридические требования:</strong> должности из ЕКСД/ЕТКС/ОКРБ 014-2017; контроль ставок и временных вакансий.</li>
    <li><strong>Данные:</strong> positions, org_units, classifier_code, fte, valid_from/to.</li>
    <li><strong>Бизнес-правила:</strong> запрещен прием на неактивную позицию; FTE ≤ 1; временная вакансия с датой окончания.</li>
    <li><strong>Сценарии:</strong> создание позиции, временная замена, закрытие позиции.</li>
    <li><strong>Ошибки:</strong> пересечение периодов; отсутствие кода классификатора.</li>
    <li><strong>Аудит:</strong> лог изменения FTE и кода должности.</li>
    <li><strong>Тест-кейсы:</strong> создание позиции с FTE&gt;1 (ожидается блокировка); закрытие активной позиции — запрет приема; поиск по классификатору; создание временной вакансии с end_date.</li>
  </ul>

  <h3>5.2 Кадровое делопроизводство</h3>
  <ul>
    <li><strong>Назначение:</strong> прием/перевод/увольнение с юридически значимыми документами.</li>
    <li><strong>Требования:</strong> договор ≥1 год; контроль продлений; приказ обязателен; ознакомление с ЛНПА.</li>
    <li><strong>Данные:</strong> employees, employments, contracts, orders, employee_documents.</li>
    <li><strong>Правила:</strong> блокировка продления сверх лимита; пакетная генерация PDF; интеграция со СКУД по событию «приказ подписан».</li>
    <li><strong>Сценарии:</strong> прием (заявление → договор → приказ → СКУД); перевод; увольнение (уведомление сроков, приказ).</li>
    <li><strong>Ошибки:</strong> отсутствие согласия ПДн; просрочка уведомления; неверная дата приказа.</li>
    <li><strong>Аудит:</strong> подписи, версии документов, журнал согласований.</li>
    <li><strong>Тесты:</strong> продление контракта после достижения лимита (ожидается отказ); прием без свободной ставки (отказ); пакетная печать приказов; событие СКУД после подписи.</li>
  </ul>

  <h3>5.3 ФСЗН (ПУ-1/2/3)</h3>
  <ul>
    <li><strong>Назначение:</strong> формирование и контроль отчетности.</li>
    <li><strong>Требования:</strong> корректность кодов; сроки подачи; целостность периодов.</li>
    <li><strong>Данные:</strong> fszn_exports, mapping кодов должностей и договоров.</li>
    <li><strong>Правила:</strong> валидация перед выгрузкой; форматы текстовых файлов; подготовка JSON+подпись для API.</li>
    <li><strong>Сценарии:</strong> создание ПУ-1 при приеме; ПУ-2 при изменениях; ПУ-3 по итогам периода.</li>
    <li><strong>Ошибки:</strong> отсутствующий код; пересечения периодов; неподписанный файл.</li>
    <li><strong>Аудит:</strong> журнал выгрузок с статусом и хэшем файла.</li>
    <li><strong>Тесты:</strong> генерация ПУ-1 без кода должности (ошибка); попытка отправки без подписи; разбиение ПУ-3 по периодам болезни/отпуска.</li>
  </ul>

  <h3>5.4 Воинский учет</h3>
  <ul>
    <li><strong>Назначение:</strong> соблюдение сроков уведомлений и карточек.</li>
    <li><strong>Требования:</strong> обязательные данные до приказа; уведомления военкоматов; ежегодная сверка.</li>
    <li><strong>Данные:</strong> military_records, org_units, orders.</li>
    <li><strong>Правила:</strong> блокировка приказа без карточки; SLA уведомлений; отметка «сверено» с датой и ответственным.</li>
    <li><strong>Сценарии:</strong> прием — проверка статуса ВУР; увольнение — уведомление; плановая сверка.</li>
    <li><strong>Ошибки:</strong> просрочка SLA; неполные данные.</li>
    <li><strong>Аудит:</strong> логи отправок; список просрочек.</li>
    <li><strong>Тесты:</strong> приказ без данных ВУР (отказ); напоминание о сверке; фиксация отправки уведомления.</li>
  </ul>

  <h3>5.5 Табель и суммированный учет</h3>
  <ul>
    <li><strong>Назначение:</strong> учет рабочего времени и обоснование сверхурочных.</li>
    <li><strong>Требования:</strong> матрица сотрудник×день; контроль конфликтов с приказами; производственный календарь с версиями.</li>
    <li><strong>Данные:</strong> timesheets, absences, calendar_versions.</li>
    <li><strong>Правила:</strong> запрет отметок в отпуске/больничном; расчет нормы по учетному периоду; протокол расчета.</li>
    <li><strong>Сценарии:</strong> ввод табеля с клавиатуры как Excel/1С; пересчет нормы; выгрузка в бухгалтерию.</li>
    <li><strong>Ошибки:</strong> двойная явка/отпуск; несогласованный календарь.</li>
    <li><strong>Аудит:</strong> версия табеля; кто и когда менял строки; протокол расчета.</li>
    <li><strong>Тесты:</strong> отметка явки в период отпуска (ошибка); смена календаря пересчитывает норму; протокол расчета содержит итог часов.</li>
  </ul>

  <h2>ЭТАП 6. n8n как оркестратор (workflow-by-law)</h2>
  <p>Примеры ключевых workflow (триггер → условия → действия → артефакты → ретраи → журналирование → безопасность):</p>
  <ul>
    <li>Контроль сроков контрактов: daily trigger → контракты до окончания 60/30/10 дней → задача кадровику, проект уведомления → запись в журнал уведомлений → ретраи отправки почты/SMS.</li>
    <li>ПУ-1 при изменении ФИО/документов: событие employee.updated → если поле в перечне ПУ → генерация ПУ-1 → подпись Avest → лог отправки.</li>
    <li>Уведомления ВУР: событие order.hire/terminate → формирование уведомления → канал (email/печать) → SLA контроль → эскалация.</li>
    <li>Рассылка расчетных листков (если в объеме): событие payroll.ready → шифрование для сотрудника → отправка защищенным каналом → лог доставки.</li>
    <li>Анонимизация кандидатов при отзыве согласия: trigger consent.revoked → очистка полей → акт анонимизации.</li>
    <li>Ежедневные отчеты комплаенса: cron → выборка ошибок справочников/конфликтов табеля/просрочек уведомлений → email/Teams → лог отправки.</li>
    <li>Интеграция со СКУД: order.signed → webhooks к СКУД → подтверждение → ретраи.</li>
    <li>Контроль ежегодной сверки ВУР: cron годовой → список не сверенных карточек → задачи ответственным.</li>
  </ul>

  <h2>ЭТАП 7. Риск-реестр + план митигаций</h2>
  <table>
    <thead>
      <tr><th>Риск</th><th>Вероятность/ущерб</th><th>Детект</th><th>Митигация</th><th>Владелец</th></tr>
    </thead>
    <tbody>
      <tr><td>Утечка ПДн</td><td>Средняя/Высокий</td><td>SIEM, DLP</td><td>RLS, RBAC, шифрование, аудит доступа</td><td>ИБ</td></tr>
      <tr><td>Просрочка уведомлений (ВУР/ФСЗН)</td><td>Средняя/Средний</td><td>Алерты n8n</td><td>SLA и задачи, эскалации</td><td>Кадры</td></tr>
      <tr><td>Сопротивление пользователей</td><td>Высокая/Средний</td><td>Опросы</td><td>UX «как Excel», тренинги</td><td>Кадры/ИТ</td></tr>
      <tr><td>Грязные исторические данные</td><td>Высокая/Высокий</td><td>ETL отчеты</td><td>Data Quality dashboard, очистка</td><td>ИТ/Кадры</td></tr>
      <tr><td>Изменения законодательства</td><td>Средняя/Высокий</td><td>Мониторинг ЛНПА</td><td>Правила как данные, конфигурация без redeploy</td><td>Комплаенс</td></tr>
    </tbody>
  </table>

  <h2>ЭТАП 8. Итоговая структура отчета</h2>
  <ul>
    <li>Executive summary (1–2 страницы)</li>
    <li>Нормативная матрица соответствия</li>
    <li>Архитектура и размещение (локализация в РБ)</li>
    <li>Модель данных PostgreSQL (RLS, temporal, constraints)</li>
    <li>КЭДО/ЭЦП и криптография (Avest/GosСУОК)</li>
    <li>Модульный анализ (Штатка, Кадры, ФСЗН, ВУР, Табель)</li>
    <li>Каталог workflow n8n</li>
    <li>Риски и внедрение</li>
    <li>Приложения: словарь данных, перечень логов/аудитов, тест-кейсы, чек-лист комплаенса перед запуском</li>
  </ul>
</body>
</html>
